var __assign=function(){return __assign=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},__assign.apply(this,arguments)};function __awaiter(e,t,r,n){return new(r||(r=Promise))((function(o,a){function i(e){try{s(n.next(e));}catch(e){a(e);}}function c(e){try{s(n.throw(e));}catch(e){a(e);}}function s(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t);}))).then(i,c);}s((n=n.apply(e,t||[])).next());}))}function __generator(e,t){var r,n,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=c(0),i.throw=c(1),i.return=c(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(c){return function(s){return function(c){if(r)throw new TypeError("Generator is already executing.");for(;i&&(i=0,c[0]&&(a=0)),a;)try{if(r=1,n&&(o=2&c[0]?n.return:c[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,c[1])).done)return o;switch(n=0,o&&(c=[2&c[0],o.value]),c[0]){case 0:case 1:o=c;break;case 4:return a.label++,{value:c[1],done:!1};case 5:a.label++,n=c[1],c=[0];continue;case 7:c=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==c[0]&&2!==c[0])){a=0;continue}if(3===c[0]&&(!o||c[1]>o[0]&&c[1]<o[3])){a.label=c[1];break}if(6===c[0]&&a.label<o[1]){a.label=o[1],o=c;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(c);break}o[2]&&a.ops.pop(),a.trys.pop();continue}c=t.call(e,a);}catch(e){c=[6,e],n=0;}finally{r=o=0;}if(5&c[0])throw c[1];return {value:c[0]?c[1]:void 0,done:!0}}([c,s])}}}"function"==typeof SuppressedError?SuppressedError:function(e,t,r){var n=new Error(r);return n.name="SuppressedError",n.error=e,n.suppressed=t,n};

var Assistant=function(){function t(t,s,n,e){var i=this;this.key=t,this.socket=s,this.chatWindow=n,this.marked=e,this.messages=[],this.isTyping=!1,this.typingId=null,s.on("bot_action",(function(t,s,n,e){return __awaiter(i,[t,s,n,e],void 0,(function(t,s,n,e){var i,o,a=n.id;return __generator(this,(function(n){switch(n.label){case 0:return console.info(t,s),"clarifyQuestion"===t?(i=s.options.split(","),this.onNewMessage({id:a,text:s.text,html:this.marked.parse(s.text)}),this.onUpdateMessage({id:a,text:s.text,html:this.marked.parse(s.text),buttons:i,callback:e}),[2]):[4,this.onAction(t,s)];case 1:return o=n.sent(),e(o),[2]}}))}))})),s.on("message",(function(t,s){i.onMessage(t,s);}));}return t.prototype.onAction=function(t,s){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(n){return console.info(t,s),[2,[{type:"text",content:"Hello"}]]}))}))},t.prototype.onMessage=function(t,s){if("start_typing"===t?(this.typingId=s.id,this.isTyping=!0,this.chatWindow.lockSendButton(!0),this.onStatusUpdate(!0)):"stop_typing"===t&&(this.typingId=null,this.isTyping=!1,this.chatWindow.lockSendButton(!1),this.onStatusUpdate(!1)),"typing"===t){var n=this.messages.find((function(t){return t.id===s.id}));n||(n={id:s.id,text:""},this.messages.push(n),this.onNewMessage(n));for(var e=0,i=s.content;e<i.length;e++){var o=i[e];n.text+=o.text.value,n.html=this.marked.parse(n.text),this.onUpdateMessage(n);}}},t.prototype.onNewMessage=function(t){this.chatWindow.createMessage(__assign({role:"assistant"},t));},t.prototype.onUpdateMessage=function(t){this.chatWindow.updateMessage(__assign({role:"assistant"},t));},t.prototype.onStatusUpdate=function(t){console.info("Lock send button",t);},t.prototype.focus=function(){this.chatWindow.focus();},t}();

var ChatWindow=function(){function t(t,e){this.el=t,this.options=e,this._messages=[],this._isLocked=!1;}return t.prototype.createMessage=function(t){var e,a,i=null!==(e=t.id)&&void 0!==e?e:Math.random().toString(36).substring(7);this._messages.push(t);var n=document.createElement("div");n.classList.add("ai-dialog__message-container"),n.classList.add("type-".concat(t.role));var o=document.createElement("div");return o.classList.add("ai-dialog__message"),o.innerText=null!==(a=t.text)&&void 0!==a?a:"",o.setAttribute("data-id",i),n.append(o),this._messagesContainer.append(n),this.scrollToBottom(),i},t.prototype.scrollToBottom=function(){var t=this;setTimeout((function(){t._scrollingContainer.scrollTop=t._scrollingContainer.scrollHeight;}),100);},t.prototype.updateMessage=function(t){var e,a=this._messages.find((function(e){return e.id===t.id}));if(a){var i=this._messagesContainer.querySelector('[data-id="'.concat(a.id,'"]'));if(i){if(i.innerHTML=null!==(e=t.html)&&void 0!==e?e:"",t.buttons){var n=document.createElement("div");n.classList.add("ai-dialog__message-buttons"),t.__fired=!1;for(var o=function(e){var a=document.createElement("button");a.classList.add("ai-dialog__message-button"),a.innerText=e,a.addEventListener("click",(function(i){var n;t.__fired||(t.__fired=!0,a.classList.add("active"),null===(n=t.callback)||void 0===n||n.call(t,e));})),n.append(a);},s=0,l=t.buttons;s<l.length;s++){o(l[s]);}i.append(n);}this.scrollToBottom();}}},t.prototype.init=function(){var t,e=this,a=this.el.attachShadow({mode:"open"}),i=document.createElement("link");i.rel="stylesheet",i.href=this.options.cssPath,a.appendChild(i);var n=document.createElement("link");n.rel="stylesheet",n.href="https://fonts.googleapis.com/css2?family=Open+Sans:ital,wght@0,300..800;1,300..800&display=swap",this.el.appendChild(n);var o=document.createElement("div");o.classList.add("ai-dialog"),o.style.display="none";var s=document.createElement("div");s.classList.add("ai-dialog__header"),o.append(s);var l=document.createElement("div");l.classList.add("ai-dialog__header-buttons"),s.append(l);var d=document.createElement("div");d.classList.add("ai-dialog__header-buttons-right"),s.append(d);var r=document.createElement("button");if(r.classList.add("ai-dialog__header-title"),r.innerHTML=null!==(t=this.options.title)&&void 0!==t?t:"",l.append(r),this.options.showFullscreen){var c=document.createElement("button");c.setAttribute("type","button"),c.classList.add("ai-dialog__header-button"),c.innerHTML='<svg aria-hidden="true" focusable="false" class="octicon octicon-screen-full" viewBox="0 0 16 16" width="16" height="16" fill="currentColor" style="display: inline-block; user-select: none; vertical-align: text-bottom; overflow: visible;"><path d="M1.75 10a.75.75 0 0 1 .75.75v2.5c0 .138.112.25.25.25h2.5a.75.75 0 0 1 0 1.5h-2.5A1.75 1.75 0 0 1 1 13.25v-2.5a.75.75 0 0 1 .75-.75Zm12.5 0a.75.75 0 0 1 .75.75v2.5A1.75 1.75 0 0 1 13.25 15h-2.5a.75.75 0 0 1 0-1.5h2.5a.25.25 0 0 0 .25-.25v-2.5a.75.75 0 0 1 .75-.75ZM2.75 2.5a.25.25 0 0 0-.25.25v2.5a.75.75 0 0 1-1.5 0v-2.5C1 1.784 1.784 1 2.75 1h2.5a.75.75 0 0 1 0 1.5ZM10 1.75a.75.75 0 0 1 .75-.75h2.5c.966 0 1.75.784 1.75 1.75v2.5a.75.75 0 0 1-1.5 0v-2.5a.25.25 0 0 0-.25-.25h-2.5a.75.75 0 0 1-.75-.75Z"></path></svg>',c.onclick=function(){e.onFullscreen();},d.append(c);}var u=document.createElement("button");u.setAttribute("type","button"),u.classList.add("ai-dialog__header-button"),u.innerHTML='<svg aria-hidden="true" focusable="false" class="octicon octicon-x" viewBox="0 0 16 16" width="16" height="16" fill="currentColor" style="display: inline-block; user-select: none; vertical-align: text-bottom; overflow: visible;"><path d="M3.72 3.72a.75.75 0 0 1 1.06 0L8 6.94l3.22-3.22a.749.749 0 0 1 1.275.326.749.749 0 0 1-.215.734L9.06 8l3.22 3.22a.749.749 0 0 1-.326 1.275.749.749 0 0 1-.734-.215L8 9.06l-3.22 3.22a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042L6.94 8 3.72 4.78a.75.75 0 0 1 0-1.06Z"></path></svg>',u.onclick=function(){e.onClose();},d.append(u),this.createChatBlock(o),a.appendChild(o);},t.prototype.onClose=function(){},t.prototype.onFullscreen=function(){},t.prototype.createChatBlock=function(t){var e,a=document.createElement("div");a.classList.add("ai-dialog__chat-block"),t.append(a),this._scrollingContainer=document.createElement("div"),this._scrollingContainer.classList.add("ai-dialog__chat-scrolling-content"),a.append(this._scrollingContainer),this._messagesContainer=document.createElement("div"),this._scrollingContainer.append(this._messagesContainer),this._loadingElement=document.createElement("div"),this._loadingElement.classList.add("ai-dialog__loading"),this._loadingElement.innerText="Loading...",this._scrollingContainer.append(this._loadingElement);var i=document.createElement("div");i.classList.add("ai-dialog__textarea-container"),a.append(i);var n=document.createElement("div");if(n.classList.add("ai-dialog__textarea"),i.append(n),this.options.warningText){var o=document.createElement("div");o.classList.add("ai-dialog__warning"),o.innerHTML=this.options.warningText,i.append(o);}var s=document.createElement("form");s.classList.add("ai-dialog__form"),n.append(s),s.addEventListener("submit",this.onSubmit.bind(this)),this._input=document.createElement("textarea"),this._input.classList.add("ai-dialog__input"),this._input.placeholder=null!==(e=this.options.textareaPlaceholder)&&void 0!==e?e:"",s.append(this._input),this._input.addEventListener("keyup",this.onKeyUp.bind(this));},t.prototype.onAskBot=function(t){console.info("Ask bot",t);},t.prototype.onKeyUp=function(t){var e;"Enter"!==t.key||""===t.target.value||t.shiftKey||(null!==(e=t.target.value)&&void 0!==e?e:"").toString().trim().length&&!this._isLocked&&(this.onAskBot(t.target.value),this.createMessage({role:"user",text:t.target.value}),t.target.value="",this.lockSendButton(!0));},t.prototype.onSubmit=function(t){console.info(t);},t.prototype.lockSendButton=function(t){this._isLocked=t,t?this._loadingElement.classList.add("show"):this._loadingElement.classList.remove("show");},t.prototype.focus=function(){this._input.focus();},t}();

var index = {};function useAssistant(n,t){return __awaiter(this,void 0,void 0,(function(){var e,o,r,i,s,a,c,d=this;return __generator(this,(function(u){switch(u.label){case 0:return [4,getLibs()];case 1:return e=u.sent(),o=e.io,r=e.marked,(i=new r.Renderer).link=function(n){var t=n.href,e=n.title,o=n.text;console.info(arguments);return '<a href="'.concat(t,'" target="').concat("_blank",'" rel="').concat("noopener noreferrer",'" title="').concat(e||"",'">').concat(o,"</a>")},r.setOptions({renderer:i,gfm:!0,breaks:!0,sanitize:!1}),s=o(t.url,__assign(__assign({},t),{extraHeaders:__assign(__assign({},t.extraHeaders||{}),{"x-assistant":n})})),a=new ChatWindow(t.container,t),c=new Assistant(n,s,a,r),a.init(),a.onAskBot=function(n){return __awaiter(d,void 0,void 0,(function(){return __generator(this,(function(t){return s.emit("ask",{id:"1",text:n}),[2]}))}))},a.onClose=function(){t.onClose&&t.onClose();},a.onFullscreen=function(){t.onFullscreen&&t.onFullscreen();},[2,c]}}))}))}function getLibs(){return void 0!==window.io&&void 0!==window.marked?{io:window.io,marked:window.marked}:Promise.all([loadScript("https://cdn.socket.io/4.7.2/socket.io.min.js"),loadScript("https://cdn.jsdelivr.net/npm/marked/marked.min.js")]).then((function(){return {io:window.io,marked:window.marked}}))}function loadScript(n){return new Promise((function(t,e){var o=document.createElement("script");o.src=n,o.async=!0,o.onload=function(){t();},o.onerror=function(){e();},document.head.appendChild(o);}))}

export { index as default, useAssistant };
//# sourceMappingURL=slavik.esm.js.map
